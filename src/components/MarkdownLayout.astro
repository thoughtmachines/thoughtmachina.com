---
// src/components/MarkdownLayout.astro
import "../styles/notion-md.css";

// Render the slot content and extract headings dynamically
const headings = [];
---

<head>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />

    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"
    ></script>

    <script>
        hljs.highlightAll();
    </script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@700&display=swap");

        header {
            font-family: "IBM Plex Mono", monospace; /* Change to IBM Plex Mono */
            font-weight: 700; /* Bold */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: black;
            text-decoration: none;
        }

        .logo-highlight {
            color: #1d4ed8; /* Blue for "The Thought" */
        }

        nav {
            display: flex;
            gap: 1.5rem;
        }

        nav a {
            text-decoration: none;
            color: #333;
            font-size: 1rem;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav a:hover {
            color: #1d4ed8;
        }

        .logo span {
            display: block; /* default for mobile */
        }

        @media (min-width: 768px) {
            .logo span {
                display: inline; /* inline for desktop */
            }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <header>
        <!-- <a href="/" class="logo">
            The <span class="logo-highlight">thought</span> blog
        </a> -->
        <a
            href="/"
            class="logo text-center text-lg md:text-2xl md:text-left font-bold"
        >
            <span class="block md:inline">The</span>
            <span class="block md:inline logo-highlight">thought</span>
            <span class="block md:inline">blog</span>
        </a>
        <nav>
            <a href="/" style="color:#1d4ed8">Home</a>
            <!-- <a href="/about">About</a> -->
            <a href="/blog">Blog</a>
            <!-- <a href="/contact">Contact</a> -->
        </nav>
    </header>
    <div class="layout">
        <aside class="sidebar">
            <nav>
                <ul>
                    <script>
                        // Extract headings dynamically from the rendered content
                        document.addEventListener("DOMContentLoaded", () => {
                            const content =
                                document.querySelector(".markdown-content");
                            const sidebar =
                                document.querySelector(".sidebar nav ul");
                            const headings = content
                                ? content.querySelectorAll("h1, h2, h3")
                                : [];

                            headings.forEach((heading) => {
                                const level = parseInt(heading.tagName[1]); // Get heading level
                                const text = heading.textContent
                                    ? heading.textContent.trim()
                                    : ""; // Get heading text
                                const id =
                                    heading.id ||
                                    text.toLowerCase().replace(/\s+/g, "-"); // Generate or use existing ID
                                heading.id = id; // Set the ID on the heading

                                // Add the heading to the sidebar
                                const li = document.createElement("li");
                                li.style.marginLeft = `${(level - 1) * 1.5}rem`;
                                const a = document.createElement("a");
                                a.href = `#${id}`;
                                a.textContent = text;
                                li.appendChild(a);
                                if (sidebar) {
                                    sidebar.appendChild(li);
                                }
                            });
                        });
                    </script>
                </ul>
            </nav>
        </aside>
        <main class="markdown-content">
            <slot />
        </main>
    </div>

    <style>
        .layout {
            display: flex;
        }

        .sidebar {
            font-family: "Georgia", "Times New Roman", Times, serif;
            font-size: 14px;
            top: 4rem; /* Adjust this value to match the height of the top bar */
            z-index: 5; /* Ensure the sidebar is below the top bar */
            width: 250px;
            padding: 1rem;
            background-color: #fffdf9;
            position: sticky; /* Make the sidebar sticky */
            top: 4rem; /* Stick to the top of the viewport */
            height: calc(
                100vh
            ); /* Ensure the sidebar spans the viewport height minus the top bar */
            overflow-y: auto; /* Add scrolling if the content overflows */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            line-height: 1.4;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
        }

        .sidebar nav ul li {
            margin-bottom: 0.5rem;
        }

        .sidebar nav ul li a {
            text-decoration: none; /* Remove underline */
            color: #333;
            font-weight: 500;
            display: block;
            border-radius: 4px;
            transition:
                background-color 0.3s,
                color 0.3s; /* Smooth hover effects */
        }

        .sidebar nav ul li a:hover {
            background-color: #007acc; /* Modern hover background */
            color: white; /* Change text color on hover */
        }

        .markdown-content {
            flex: 1;
            padding: 1rem;
        }
    </style>
</body>
